# .COM网站优化内容整理

<div class="sub-title">页面制作：@lxf&emsp; 创建于：2016.10.28&emsp; 最后更新：10.28 20:38</div>


一、前台部分

* [1] (0.5d)上传收件人身份证图片，改成使用HTML方式，具体参考edockey项目
* [?] (0.5d) 订单在付款时，若余额不足则进入充值页面，但是一旦充值完成且余额充足则直接完成扣款操作
	* <span class="blue">** *API应该会有会返回值并根据提供订单号获取订单金额* **</span>
	* <span class="blue">** *余额 >= 订单金额：完成扣款并进入支付成功页面* **</span> 
	* <span class="blue">** *余额 < 订单金额：显示当前订单金额，还差好多，余额充值保证直达出库* **</span>
* [2] (1.0d) 在「我的包裹」菜单下，增加「已入库包裹」菜单，在「已入库包裹」页面，提供如下功能：
	* 拆分包裹
		* ** *模糊？精准？* **
	* 发起包裹拍照请求
	* 发起货物清点请求
	* <span class="blue">** *以上功能都需要后台配合完成* **</span> 
* [2] 原「提交回国订单」改为「创建回国订单」，并取消【拆分包裹】功能
* [2] (0.5d) 创建回国订单时，添加转运渠道的选择（增加2个临时渠道字段：temp_channel_id，temp_channel_name）；同时，提交成功后，需重新生成一个订单对应的货位号（需要一个helper方法来生成）--- OK，需要新增表
	* ** *新增表可参考原始shelf字段* **
	* ** *当出库后删除该字段即可* **
	* ** *生成该货位号时是否有* **
* [1] (1.0d) 到货预报
	* 优化商品信息的填写，参考edockey
	* 运单号的填写方式，给一个帮助
* [1] (0.5d) 认领包裹优化：当用户在前台认领之后，直接是「已入库」状态（需要注意认领成功之后的提示，应该明确显示包裹已入库）

二、后台部分

* [1] (0.5d) 入库页面，把包裹拍照和货物清点分离，只管包裹入库；同时，入库后打印货位号
* [2] (1.0d) 后台【包裹管理】主菜单下添加「待拍照」和「待清点」功能
* [1] (0.5d) 入库页面，发起异常包裹时，直接选异常类型，不用填，减轻仓库录入时间
	* 找冬梅要类型
* [2] (1.0d) 后台拆分包裹也要根据拆分方式进行调整
	* 如果是模糊拆分：则只需录入每个包裹的重量和大概的内件信息（录入一条）
	* 如果是精确拆分，则只需录入每个包裹的重量（内件信息不用录入了，由用户在前台填写）
	* 拆分后，仍然是包裹，不再生成AT**订单。因此，adi_package表至少需要增加「parent_* id」和「parent_pid」字段，表示由哪个包裹拆分而来
	* 同时，当仓库工作人员在后台拆分之后，包裹直接是「已入库」状态
* [2] (1.0d) 发起包裹认领
	* 第一步：由仓库端发起，只需填写包裹重量、包裹是否破损以及上传包裹外部面单（必传），该消息* 发送至国内客服
	* 第二步：国内客服收到仓库发起的待认领包裹，根据所拍的包裹照片，完善客户姓名及客户代码
	* 第三步：国内客服完善上述内容之后，最终才把「待认领」包裹推送给用户前台
* [1] (1.0d) 增加导入跟踪号功能，参考edockey
* [1] (0.5d)设置出库时，直接读取已导入的跟踪号，不用再人工录入
* [2] (3.0d)增加每个渠道面单打印功能（需要提供每个渠道面单的样式以及面单上面的内容）
* 增加退运流程（待讨论具体流程）


三、本次待处理

>
核心调整：
>
在创建回国订单时，让用户选择期望的转运渠道；当仓库端称重后，如果包裹重量满足所选渠道支持的重量，同时用户账户余额充足，则直接扣款，订单变为「待出库」状态
>
需求说明：
>
前台：用户选择了提交回国订单，在进入提交回国订单页面后，把仓库对应的转运渠道以列表的方式呈现出来，供用户选择
	1. <span class="red">根据用户提交的入库包裹重量之和，提供渠道列表</span>
	2. <span class="red">页面的说明也应当有体现</span>
前台：根据用户选择的转运渠道，结合包裹的入库重量(之和)，计算出预估的运费
	1. 展示奶粉渠道附加信息
	1. <span class="red">提交后邮件说明有变化</span>
	2. 插入注意渠道应插入temp那张表哦
	2. 插入奶粉附加信息
后台：当包裹称重后：
	*目前是：[120已生成回国订单，等待打包称重]->[200打包称重完成，等待付款]->[201已付款，等待发运回国]

	* 如果包裹重量满足所选渠道的重量；同时，用户账户余额充足，则直接扣款；订单变为「待出库」状态。而且还需要把 temp_channel_id 和 temp_channel_name 的值分别更新到 channel_id 和 channel_name 字段，表明这个时候转运渠道是已经确认的了
	1. [120已生成回国订单，等待打包称重]->[200打包称重完成，等待付款]->[201已付款，等待发运回国]

	* 如果包裹重量满足所选渠道的重量，但是，用户账户余额不足，则订单变为「待付款」状态，让用户充值/付款。而且还需要把 temp_channel_id 和 temp_channel_name 的值分别更新到 channel_id 和 channel_name 字段，表明这个时候转运渠道是已经确认的了
	1. [120已生成回国订单，等待打包称重]->[200打包称重完成，等待付款]	
	
	* 如果包裹重量不满足所选渠道支持的重量，订单变为「等待确认转运渠道」状态，让用户重新确认本次包裹发运的渠道（其实就是目前的「确定订单金额」的那个状态）
	1. <span class="red">对应total_confirm页面</span>
	2. 1. [120已生成回国订单，等待打包称重]->[200打包称重完成，等待付款]但是是等待付款的页面
特别注意事项：包裹称重后，对应3种情况，这3种情况发送的email内容需要调整！(这里其实是发的一封邮件内容不同而已)



```
sql语句：

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
SET time_zone = "+00:00";
CREATE TABLE `adi_transfer_temp_channel` (
  `transfer_id` int(11) NOT NULL COMMENT '订单ID',
  `channel_id` int(11) NOT NULL COMMENT '临时的渠道ID',
  `channel_name` varchar(32) NOT NULL COMMENT '临时的渠道名称',
  `added_date` datetime NOT NULL COMMENT '添加时间',
  `added_ip` varchar(16) DEFAULT NULL COMMENT '添加时的IP'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='订单和临时渠道关联表，用于创建回国订单';
ALTER TABLE `adi_transfer_temp_channel` ADD UNIQUE KEY `transfer_id` (`transfer_id`);
```


四、已处理

* [x] ~~取消【上传身份证】功能~~
* [x] ~~前台订单详情页面，显示包裹运单号~~
* [X] ~~打印称重那张纸时，清单中的增值服务添加"x2"字样的数量~~
* [x] ~~收货地址不再限制以”XX市”开头，并且把“收货地址”改为“详细地址”~~
* [x] ~~「我的订单」里面的所有订单、待付款、待出库、已出库这几个作为子菜单放到「我的订单」下~~
	* ~~<span class="blue">** *待付款，待出库需要显示目前个数* **</span>~~
* [x] ~~(0.5d) 后台包裹入库时：
	* ~~在索引包裹物流跟踪号的时候，可以进行后四位的模糊查询及结果显示~~
	* ~~把FIRSTNAME和LASTNAME进行合并，在同一个搜索框内进行索引，支持模糊查询及结果显示~~
* [x] ~~(0.5d) 包裹货位号，改成「客户姓名首字母+4位随机数」（修改相对简单，不过需要重点测试一下从入库到最后出库整个流程，观察货位号是否被正确释放）~~
* [x] ~~订单扩展信息，添加「奶粉类型」字段~~
* [x] ~~(0.5d)「我的订单」列表，增加搜索功能，搜索条件包括：~~
	* ~~仓库~~
	* ~~渠道~~
	* ~~订单号~~
	* ~~订单提交时间（默认显示最近3个月订单）~~


