# To Do

## HIVE
 * #### HIVE需求成本价格用人民币
 * #### 价格不支持小数

## adi
 - 有价格的有商品的费用，直邮的费用，运费，商家供应的费用，成本

 - 购物车（存储价格）

- 转运
  - adi_package
  - adi_package_product中有
  - adi_package_total
  - adi_customer
  - adi_package_total
  - adi_transaction
  - adi_package_total

- 直邮

- 产品销售统计

***
  * 商品金额及运费，使用人民币；前台展示也用人民币
    - 展示页面mall/supplier 有价格显示的地方
      ``` <?php echo $product->direct_mail_status == 1 ? $product->direct_mail_price : $product->price; ?> ```
    - 产品详情页面mall/detail 有价格显示的地方
      ```
        <input type="hidden" name="hd_price" value="<?php echo $base->price; ?>">// 这个属于隐藏域决定的是购物车显示的金额，不参与计算

        <li><label><?php if ($base->is_bundled) { ?>套 餐 价<?php } else { ?>商品价格<?php } ?>：</label><span class="price"><?php echo $base->currency_symbol; ?> <?php echo $base->price; ?></span>（￥<?php echo $price_rmb; ?>）</li>

        <li><label>直邮价格：</label><span class="price"><?php echo $base->currency_symbol; ?> <?php echo $base->direct_mail_price; ?></span>（￥<?php echo $direct_mail_price_rmb; ?>）</li>
                            <li>
      ```

    - 转运产品将提交到cart/add
        引入cymbel货比符号
        新数据（price_rmb）应当提前直接存入cookie的price并可以直接展示到页面
        老数据在取出时需要换算一次---------
    - 购物车页面 checkout/cart
        get_items_products_detail_by_warehouse
        get_items_info_by_warehouse
          这两个方法就应该完成上面的描述：换算成人民币

        ```$items_info[$item['warehouse_id']]['total']```
          注意这个变量的值需要换算成人民币（若购物车当中有price_rmb并且也有price）
    - 结算页面 checkout/index

    - 结算 checkout/confirm


    - 直邮产品将提交到...





---
 * 导出订单
  - 转运渠道，增加一个“全部” 保证能搜索全部渠道的订单
  - 增加一个搜索条件是增值服务选项

 * 后台称重
    1.


 * 新拆分后的包裹已不存在，如何查到拆分后的包裹（目前可在带拆分包裹的已处理查看）


 * 前台异常包裹，访问详情只根据id来查，应当过滤，只查看当前的用户的包裹


 * #### 后台修改订单重量时若大于该渠道最大值时应禁止修改(修改有最大或最小限制时都应该考虑)
       - 修改重量时也应同时修改对应的增值服务
       - 修改时使用了优惠券
 * #### 后台修改渠道应对渠道是否要求证件信息做出判断

 * ##### 前台显示奶粉附加信息
 * ##### 后台修改重量取消对重量录入的限制（取消intger_require的class）
 * ##### 台后台地址完全展示(print_address_page,print_order_addresses_page)
            * ```<?php echo $transfer->receiver_province ?  ($transfer->receiver_province . $transfer->receiver_city . $transfer->receiver_district) : $transfer->receiver_city_name; ?> <?php echo $transfer->receiver_address; ?>```

 * ##### 已认领包裹添加一个修改运单号的功能



 * ### 上传收件人身份证图片，改成使用HTML方式，具体参考edockey项目
 * ### 订单在付款时，若余额不足则进入充值页面，但是一旦充值完成且余额充足则直接完成扣款操作

 * ### 认领包裹优化：当用户在前台认领之后，直接是「已入库」状态（需要注意认领成功之后的提示，应该明确显示包裹已入库）

 * ### 增加每个渠道面单打印功能

 * ### 增加退运流程


- [x]  ~~ 后台订单详情页面对拆分包裹添加一个展示：拆分包裹的备注 ~~
- [x]  ~~ 修改渠道的条件应该有个在设置出单后就不能修改了 ~~
- [x]  ~~ AT3143749447无地址但是提交成功了（该订单是拆分而来，观察是否还有类似的情况）~~

<span class="red">----------------------------------------------------------------------------------</span>
# Done

- [x]  ~~ 购物车结算时alert弹窗选择收件地址~~
- [x]  ~~ 4、5、6号QQ群添加已满 ~~
- [x]  ~~ 删除controller/transfer total_confirms中的error_reporting ~~
- [x]  ~~ 退款已审核添加搜索功能 ~~
- [x]  ~~ 新增仓库增值服务合并包裹按重量支持 ~~
       ~~ * 按重量选中的配置 ~~
       ~~ * 如果只有1个包裹那么不按重量选中 ~~
- [x]  ~~ 新增仓库增值服务对于拆分包裹的支持（之前流程是不要）~~
       ~~     * 拆分分别支持拆分数量和重量 ~~
       ~~         - 前台拆分包裹选中对应的拆分服务（按重量或者按个数显示） ~~
       ~~         - 提交拆分信息时应当有个收费提示，提交时扣费 ~~
       ~~         - 插入一条收录费记录和拆分的增值服务 ~~
       ~~         - 后台拆分页面不展示拆分信息 ~~
       ~~     * 对拆分的包裹添加一个拆分的增值服务 ~~
       ~~     * 拆分时收取费用并体现在transaction当中 ~~
- [x]  ~~ 设为已开单页面做一个全选，不全选的按钮 ~~

- [x]  ~~ 后台修改重量时，体积重的方式重新计算 ~~
       ~~        - 后台订单详情页面对修改订单重量，用户余额不足时修改重量不成功，但是<span class="red">显示成功</span> ~~
       ~~        - 当实际重量发生变化那么增值服务也应当随之修改（暂不处理） ~~
       ~~     - 解决思路： ~~
       ~~     1. 思考使用面向对象编程 ~~
       ~~         * 该类里面还有另外两个方法（对地址和路径的修改） ~~
       ~~         *   ~~
       ~~         * 修改不成功但是显示成功是因为load_list_detail 的判断条件错误（edit_channel,edit_weight尽量用一种标准） ~~
- [x]  ~~ .fr网站也需要kuaidi100的查询 ~~

- [x]  ~~ 合并包裹也算有重量要求的增值服务 ~~

- [x]  ~~ 新增的仓库拆分时对于必选增值服务的支持 ~~

- [x]  ~~ 拆分包裹重量超过最大重量（？谁的最大：默认拆分数量2的最大重量，比如法国仓库的包裹重100KG，那么2的重量就是50KG，这个50KG超过了增值服务支持的最大重量30KG），将不会显示标固等必选增值服务；当包裹重量 / 选择的拆分数量支持最大自持必选增值服务时，依旧没显示 ~~
- [x]  ~~ 后台修改渠道若是改为奶粉渠道应当要求填写奶粉的附加信息
- [X]  ~~ 获取nutrland代码，数据库密码,ftp密码;edockey数据库密码,ftp密码 ~~

- [X]  ~~ 奶粉和小包的最后一个状态由包裹投递中改为'香港邮政已发货' ~~

- [X]  ~~ 安达易法国转运8群 476301090 ~~

- [X]  ~~ 邮箱header调整 ~~

- [X]  ~~ adi后台称重页面添加增值服务的样式 ~~

- [X]  ~~ 后台修改收货地址条件，不受是否有收货地址的限制 ~~

- [X]  ~~ 后台adi_v3_admin登录到前台adi_v3的功能（优先）~~

- [X]  ~~ * 签收包裹和已预报包裹未关联 ~~
  >* package_model->get_package_by_website_no 条件错误应该是找website_tracking_no和website_order_no一起找
  * 不同仓库的产品在购物车页面分开结算
    - 在结算页面分开展示商品信息,以购买产品所属仓库的个数显示多个结算按钮
  * 调整结算页面的 hd_warehouse_id 隐藏域的值
    - 目前的hd_warehouse_id写死的为1，由于支持了澳洲也应该对应调整这里
  * 直邮商品，点击直邮购买按钮后，即便已登录，也弹出了登录框，这里要调整
    - 这个关键还是看login的验证方法，验证是否login后在决定后续的操作，登陆了则可以经行其他操作，没登陆则要求登陆，改一个方法应当支持其他地方，购物车，商品详情
  * 直邮商品，点击直邮购买按钮后，即便已登录，也弹出了登录框，这里要调整
    - btn_checkout_submit这个JS应当先触发一个方法这个方法是用来验证用户登陆的需要ajax,返回结果后再决定执行show_login还是btn_checkout_submit本身

- [x] ~~  * 邀请奖励优化：在考虑用户是否曾经预报时，要排除已取消的包裹~~
  > 看用户是否有邀请奖励记录（adi_commission_history），有说明就享受过邀请奖励（package/confirm）
- [x] ~~  * ### 拍照的增值服务需要添加VIP半价 ~~
- [x] ~~  * ### 后台【回国订单】搜索优化 ~~
       >~~目前，后台【回国订单】页面的搜索功能，其执行的SQL较复杂，导致执行效率不高，需要进行优化。~~
       优化思路：
       ~~ 1、根据搜索条件，构造不同的SQL，避免所有搜索SQL都使用相同的SQL语句（每个选项卡根据选项卡独有条件单独的字段） ~~
       2、增值服务字符串，是通过子查询方式获取，查询开销较大，考虑在 adi_transfer 表新增「增值服务」字段，用于存储订单的增值服务字符串（这个字符串的构成应该是：增值服务名称 * 个数）
              * 任何涉及到订单增值服务调整的地方，都应该更新 adi_transfer 表的「增值服务」字段：
              * 创建回国订单时同时
              * 称重时，修改增值服务的时候
              * 修改重量时，导致增值服务变化的时候
       3、货位号查询（考虑是否可以直接like transfer表中的这个字段）
       ~~ 4、不同的SQL体现在：~~
            ~~ * 返回的字段~~
            ~~ * 关联的表(前提还是在不需要在关联表中提取字段时，才考虑)~~
- [x] ~~ * ### 到货预报 ~~
      > * 优化商品信息的填写，参考edockey
        * 运单号的填写方式，给一个帮助
- [x] ~~  * 后台香港邮政已发货后的状态变化的文字描述，考虑取消包裹已签收 ~~
